"use strict";(globalThis.webpackChunkrobotic_book=globalThis.webpackChunkrobotic_book||[]).push([[870],{4434:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>t});const o=JSON.parse('{"id":"module1-ros2/ros2-packages","title":"Building Reusable ROS 2 Packages and Workspaces","description":"This chapter details the process of structuring your ROS 2 projects into reusable packages and managing them within a colcon workspace. A well-organized workspace is crucial for collaborative development, code sharing, and efficient build processes.","source":"@site/docs/module1-ros2/04-ros2-packages.mdx","sourceDirName":"module1-ros2","slug":"/module1-ros2/ros2-packages","permalink":"/Physical-AI-and-Humanoid-Robotics-book/docs/module1-ros2/ros2-packages","draft":false,"unlisted":false,"editUrl":"https://github.com/yourusername/physical-ai-humanoid-book/tree/main/docs/module1-ros2/04-ros2-packages.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Creating and Publishing Custom ROS 2 Messages","permalink":"/Physical-AI-and-Humanoid-Robotics-book/docs/module1-ros2/custom-messages"},"next":{"title":"URDF & Xacro Modeling for Humanoid Robots","permalink":"/Physical-AI-and-Humanoid-Robotics-book/docs/module1-ros2/urdf-xacro-modeling"}}');var s=r(4848),a=r(8453);const i={},c="Building Reusable ROS 2 Packages and Workspaces",l={},t=[{value:"ROS 2 Package Structure",id:"ros-2-package-structure",level:2},{value:"<code>colcon</code> Workspaces",id:"colcon-workspaces",level:2},{value:"Best Practices for Reusability",id:"best-practices-for-reusability",level:2},{value:"Example: Humanoid Control Package",id:"example-humanoid-control-package",level:2},{value:"1. Package Structure",id:"1-package-structure",level:3},{value:"2. Package Configuration Files",id:"2-package-configuration-files",level:3},{value:"<code>package.xml</code>",id:"packagexml",level:4},{value:"<code>CMakeLists.txt</code>",id:"cmakeliststxt",level:4},{value:"3. Python Node and Setup File",id:"3-python-node-and-setup-file",level:3},{value:"<code>setup.py</code>",id:"setuppy",level:4},{value:"<code>simple_controller.py</code>",id:"simple_controllerpy",level:4},{value:"4. How to Build and Run",id:"4-how-to-build-and-run",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"building-reusable-ros-2-packages-and-workspaces",children:"Building Reusable ROS 2 Packages and Workspaces"})}),"\n",(0,s.jsxs)(n.p,{children:["This chapter details the process of structuring your ROS 2 projects into reusable packages and managing them within a ",(0,s.jsx)(n.code,{children:"colcon"})," workspace. A well-organized workspace is crucial for collaborative development, code sharing, and efficient build processes."]}),"\n",(0,s.jsx)(n.h2,{id:"ros-2-package-structure",children:"ROS 2 Package Structure"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Minimal Package"}),": Essential files (",(0,s.jsx)(n.code,{children:"package.xml"}),", ",(0,s.jsx)(n.code,{children:"CMakeLists.txt"}),"/",(0,s.jsx)(n.code,{children:"setup.py"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Source Files"}),": Organizing C++ (",(0,s.jsx)(n.code,{children:"src/"}),") and Python (",(0,s.jsx)(n.code,{children:"<package_name>/"}),") code."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Message/Service/Action Definitions"}),": Placing custom interfaces (",(0,s.jsx)(n.code,{children:"msg/"}),", ",(0,s.jsx)(n.code,{children:"srv/"}),", ",(0,s.jsx)(n.code,{children:"action/"}),")."]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"colcon-workspaces",children:[(0,s.jsx)(n.code,{children:"colcon"})," Workspaces"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Creating a Workspace"}),": Initializing your ",(0,s.jsx)(n.code,{children:"colcon"})," workspace."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Building Packages"}),": Using ",(0,s.jsx)(n.code,{children:"colcon build"})," for efficient compilation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sourcing the Workspace"}),": Making your installed packages available in the environment."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Overlaying Workspaces"}),": Managing dependencies between different workspaces."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices-for-reusability",children:"Best Practices for Reusability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Clear API"}),": Designing package interfaces for easy integration."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Documentation"}),": Documenting package functionality and usage."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Version Control"}),": Managing packages with Git."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"example-humanoid-control-package",children:"Example: Humanoid Control Package"}),"\n",(0,s.jsxs)(n.p,{children:["Let's create a structured ROS 2 package for a simple humanoid controller within a ",(0,s.jsx)(n.code,{children:"colcon"})," workspace. This package will demonstrate typical organization for Python nodes."]}),"\n",(0,s.jsx)(n.h3,{id:"1-package-structure",children:"1. Package Structure"}),"\n",(0,s.jsxs)(n.p,{children:["First, create the following directory structure in your ROS 2 workspace ",(0,s.jsx)(n.code,{children:"src"})," folder (or in ",(0,s.jsx)(n.code,{children:"examples/ros2_humanoid_control_example/"})," as we've done here):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"examples/ros2_humanoid_control_example/\r\n\u2514\u2500\u2500 humanoid_control/\r\n    \u251c\u2500\u2500 package.xml\r\n    \u251c\u2500\u2500 CMakeLists.txt\r\n    \u251c\u2500\u2500 setup.py\r\n    \u251c\u2500\u2500 resource/\r\n    \u2502   \u2514\u2500\u2500 humanoid_control\r\n    \u2514\u2500\u2500 humanoid_control/  # Python package directory\r\n        \u2514\u2500\u2500 simple_controller.py\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-package-configuration-files",children:"2. Package Configuration Files"}),"\n",(0,s.jsx)(n.h4,{id:"packagexml",children:(0,s.jsx)(n.code,{children:"package.xml"})}),"\n",(0,s.jsxs)(n.p,{children:["This file describes the ",(0,s.jsx)(n.code,{children:"humanoid_control"})," package, its version, description, maintainer, license, and dependencies."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'\x3c!-- examples/ros2_humanoid_control_example/humanoid_control/package.xml --\x3e\r\n<?xml version="1.0"?>\r\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\r\n<package format="3">\r\n  <name>humanoid_control</name>\r\n  <version>0.0.0</version>\r\n  <description>ROS 2 package for humanoid robot control examples</description>\r\n  <maintainer email="user@example.com">user</maintainer>\r\n  <license>Apache-2.0</license>\r\n\r\n  <buildtool_depend>ament_cmake</buildtool_depend>\r\n  <buildtool_depend>ament_python</buildtool_depend>\r\n\r\n  <depend>rclpy</depend>\r\n  <depend>std_msgs</depend>\r\n  <depend>geometry_msgs</depend>\r\n\r\n  <test_depend>ament_copyright</test_depend>\r\n  <test_depend>ament_flake8</test_depend>\r\n  <test_depend>ament_pep257</test_depend>\r\n  <test_depend>python3-pytest</test_depend>\r\n\r\n  <export>\r\n    <build_type>ament_cmake</build_type>\r\n  </export>\r\n</package>\n'})}),"\n",(0,s.jsx)(n.h4,{id:"cmakeliststxt",children:(0,s.jsx)(n.code,{children:"CMakeLists.txt"})}),"\n",(0,s.jsx)(n.p,{children:"This file specifies how the package is built, including finding necessary ROS 2 packages and installing the Python package."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cmake",children:'# examples/ros2_humanoid_control_example/humanoid_control/CMakeLists.txt\r\ncmake_minimum_required(VERSION 3.8)\r\nproject(humanoid_control)\r\n\r\nif(CMAKE_COMPILER_ID STREQUAL "GNU")\r\n  add_compile_options(-Wall -Wextra -Wpedantic)\r\nendif()\r\n\r\nfind_package(ament_cmake REQUIRED)\r\nfind_package(ament_python REQUIRED)\r\nfind_package(rclpy REQUIRED)\r\nfind_package(std_msgs REQUIRED)\r\nfind_package(geometry_msgs REQUIRED)\r\n\r\nament_python_install_package(${PROJECT_NAME})\r\n\r\nament_package()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-python-node-and-setup-file",children:"3. Python Node and Setup File"}),"\n",(0,s.jsx)(n.h4,{id:"setuppy",children:(0,s.jsx)(n.code,{children:"setup.py"})}),"\n",(0,s.jsx)(n.p,{children:"This file defines the Python package, its entry points (console scripts), and data files."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# examples/ros2_humanoid_control_example/humanoid_control/setup.py\r\nfrom setuptools import setup\r\n\r\npackage_name = 'humanoid_control'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.0.0',\r\n    packages=[package_name],\r\n    data_files=[\r\n        ('share/' + package_name, ['package.xml']),\r\n        ('share/' + package_name + '/resource', ['resource/' + package_name]),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='user',\r\n    maintainer_email='user@example.com',\r\n    description='ROS 2 package for humanoid robot control examples',\r\n    license='Apache-2.0',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'simple_controller = humanoid_control.simple_controller:main'\r\n        ],\r\n    },\r\n)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"simple_controllerpy",children:(0,s.jsx)(n.code,{children:"simple_controller.py"})}),"\n",(0,s.jsx)(n.p,{children:"A basic Python node that subscribes to high-level humanoid commands and provides feedback. In a real scenario, this would interface with joint controllers."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# examples/ros2_humanoid_control_example/humanoid_control/humanoid_control/simple_controller.py\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String # For high-level commands, or use custom messages\r\n# from geometry_msgs.msg import Pose # Example for joint control, etc.\r\n\r\nclass SimpleHumanoidController(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('simple_humanoid_controller')\r\n        self.subscription = self.create_subscription(\r\n            String, # Or a custom JointCommand message\r\n            'humanoid_commands',\r\n            self.command_listener_callback,\r\n            10)\r\n        self.subscription  # prevent unused variable warning\r\n        self.publisher_ = self.create_publisher(String, 'humanoid_feedback', 10)\r\n        self.get_logger().info('Simple Humanoid Controller Node Started')\r\n\r\n    def command_listener_callback(self, msg):\r\n        self.get_logger().info(f'Received command: \"{msg.data}\"')\r\n        # Here, you would parse the command and translate it into robot actions\r\n        # For a humanoid, this might involve:\r\n        # - Inverse kinematics to calculate joint angles\r\n        # - Publishing to joint trajectory controllers\r\n        # - Managing balance and gait\r\n        \r\n        feedback_msg = String()\r\n        feedback_msg.data = f'Executing: {msg.data}'\r\n        self.publisher_.publish(feedback_msg)\r\n        self.get_logger().info(f'Published feedback: \"{feedback_msg.data}\"')\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    simple_humanoid_controller = SimpleHumanoidController()\r\n    rclpy.spin(simple_humanoid_controller)\r\n    simple_humanoid_controller.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-how-to-build-and-run",children:"4. How to Build and Run"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Place the ",(0,s.jsx)(n.code,{children:"humanoid_control"})," package (",(0,s.jsx)(n.code,{children:"examples/ros2_humanoid_control_example/humanoid_control/"}),") into the ",(0,s.jsx)(n.code,{children:"src/"})," directory of your ROS 2 workspace."]}),"\n",(0,s.jsxs)(n.li,{children:["From the root of your ROS 2 workspace, build the package:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"colcon build --packages-select humanoid_control\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Source your workspace:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Run the controller node:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ros2 run humanoid_control simple_controller\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["In a separate terminal, publish a command:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ros2 topic pub --once /humanoid_commands std_msgs/msg/String \"data: 'wave_arms'\"\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You should see the controller node receiving and acknowledging the command."})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>c});var o=r(6540);const s={},a=o.createContext(s);function i(e){const n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkrobotic_book=globalThis.webpackChunkrobotic_book||[]).push([[452],{554:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"module1-ros2/custom-messages","title":"Creating and Publishing Custom ROS 2 Messages","description":"This chapter guides you through the process of defining, building, and using custom message types in ROS 2. Custom messages are essential for exchanging domain-specific data between nodes in your robotics application.","source":"@site/docs/module1-ros2/03-custom-messages.mdx","sourceDirName":"module1-ros2","slug":"/module1-ros2/custom-messages","permalink":"/Physical-AI-and-Humanoid-Robotics-book/docs/module1-ros2/custom-messages","draft":false,"unlisted":false,"editUrl":"https://github.com/yourusername/physical-ai-humanoid-book/tree/main/docs/module1-ros2/03-custom-messages.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Real-time Python Development with rclpy","permalink":"/Physical-AI-and-Humanoid-Robotics-book/docs/module1-ros2/rclpy-development"},"next":{"title":"Building Reusable ROS 2 Packages and Workspaces","permalink":"/Physical-AI-and-Humanoid-Robotics-book/docs/module1-ros2/ros2-packages"}}');var t=r(4848),a=r(8453);const o={},i="Creating and Publishing Custom ROS 2 Messages",c={},l=[{value:"Defining Custom Messages",id:"defining-custom-messages",level:2},{value:"Building Custom Message Packages",id:"building-custom-message-packages",level:2},{value:"Publishing and Subscribing to Custom Messages",id:"publishing-and-subscribing-to-custom-messages",level:2},{value:"Example: Custom Robot Status Message",id:"example-custom-robot-status-message",level:2},{value:"1. Define the Custom Message (<code>RobotStatus.msg</code>)",id:"1-define-the-custom-message-robotstatusmsg",level:3},{value:"2. Configure ROS 2 Package for Custom Message",id:"2-configure-ros-2-package-for-custom-message",level:3},{value:"<code>package.xml</code>",id:"packagexml",level:4},{value:"<code>CMakeLists.txt</code>",id:"cmakeliststxt",level:4},{value:"3. Build the Custom Message Package",id:"3-build-the-custom-message-package",level:3},{value:"4. Create Python Publisher and Subscriber",id:"4-create-python-publisher-and-subscriber",level:3},{value:"Publisher Node (<code>custom_status_publisher.py</code>)",id:"publisher-node-custom_status_publisherpy",level:4},{value:"Subscriber Node (<code>custom_status_subscriber.py</code>)",id:"subscriber-node-custom_status_subscriberpy",level:4},{value:"5. How to Run",id:"5-how-to-run",level:3}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"creating-and-publishing-custom-ros-2-messages",children:"Creating and Publishing Custom ROS 2 Messages"})}),"\n",(0,t.jsx)(s.p,{children:"This chapter guides you through the process of defining, building, and using custom message types in ROS 2. Custom messages are essential for exchanging domain-specific data between nodes in your robotics application."}),"\n",(0,t.jsx)(s.h2,{id:"defining-custom-messages",children:"Defining Custom Messages"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["Message Definition Files (",(0,t.jsx)(s.code,{children:".msg"}),")"]}),": Syntax and best practices for creating ",(0,t.jsx)(s.code,{children:".msg"})," files."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Data Types"}),": Understanding primitive types, arrays, and nested messages."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Header"}),": Including ",(0,t.jsx)(s.code,{children:"std_msgs/msg/Header"})," for timestamped data."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"building-custom-message-packages",children:"Building Custom Message Packages"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Package Structure"}),": Organizing your custom message definitions within a ROS 2 package."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:[(0,t.jsx)(s.code,{children:"CMakeLists.txt"})," and ",(0,t.jsx)(s.code,{children:"package.xml"})]}),": Configuring the build system for custom messages."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"colcon build"})}),": Compiling your custom message package."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"publishing-and-subscribing-to-custom-messages",children:"Publishing and Subscribing to Custom Messages"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["Python (",(0,t.jsx)(s.code,{children:"rclpy"}),") Examples"]}),": Demonstrating how to publish and subscribe to your custom messages using ",(0,t.jsx)(s.code,{children:"rclpy"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["C++ (",(0,t.jsx)(s.code,{children:"rclcpp"}),") Examples"]}),": (Optional) Demonstrating custom message usage in C++."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"example-custom-robot-status-message",children:"Example: Custom Robot Status Message"}),"\n",(0,t.jsxs)(s.p,{children:["We will create a custom message type called ",(0,t.jsx)(s.code,{children:"RobotStatus"})," to convey information about our robot's operational state."]}),"\n",(0,t.jsxs)(s.h3,{id:"1-define-the-custom-message-robotstatusmsg",children:["1. Define the Custom Message (",(0,t.jsx)(s.code,{children:"RobotStatus.msg"}),")"]}),"\n",(0,t.jsxs)(s.p,{children:["First, define the structure of our ",(0,t.jsx)(s.code,{children:"RobotStatus"})," message in a ",(0,t.jsx)(s.code,{children:".msg"})," file."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"# examples/ros2_custom_message_example/robot_status_msgs/msg/RobotStatus.msg\r\n# Contains information about the robot's current status\r\n\r\nstd_msgs/msg/Header header\r\nuint8 status_code\r\nfloat32 battery_level\r\nstring message\n"})}),"\n",(0,t.jsx)(s.p,{children:"Here:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"std_msgs/msg/Header"}),": Includes a timestamp for when the status was recorded."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"uint8 status_code"}),": A numerical code indicating the robot's state (e.g., 0 for normal, 1 for warning, 2 for error)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"float32 battery_level"}),": The current battery charge as a percentage."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"string message"}),": A human-readable message describing the status."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"2-configure-ros-2-package-for-custom-message",children:"2. Configure ROS 2 Package for Custom Message"}),"\n",(0,t.jsx)(s.p,{children:"To make ROS 2 recognize and build our custom message, we need a standard ROS 2 package."}),"\n",(0,t.jsx)(s.p,{children:"Create the package structure:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"mkdir -p examples/ros2_custom_message_example/robot_status_msgs/msg\n"})}),"\n",(0,t.jsx)(s.p,{children:"(This has already been performed)"}),"\n",(0,t.jsx)(s.h4,{id:"packagexml",children:(0,t.jsx)(s.code,{children:"package.xml"})}),"\n",(0,t.jsxs)(s.p,{children:["This file declares our package and its dependencies, including ",(0,t.jsx)(s.code,{children:"rosidl_default_generators"})," which is needed to build messages."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-xml",children:'\x3c!-- examples/ros2_custom_message_example/robot_status_msgs/package.xml --\x3e\r\n<?xml version="1.0"?>\r\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\r\n<package format="3">\r\n  <name>robot_status_msgs</name>\r\n  <version>0.0.0</version>\r\n  <description>Custom messages for robot status</description>\r\n  <maintainer email="user@example.com">user</maintainer>\r\n  <license>Apache-2.0</license>\r\n\r\n  <buildtool_depend>ament_cmake</buildtool_depend>\r\n  <buildtool_depend>rosidl_default_generators</buildtool_depend>\r\n\r\n  <depend>rclpy</depend>\r\n  <depend>std_msgs</depend>\r\n  <member_of_group>rosidl_interface_packages</member_of_group>\r\n\r\n  <export>\r\n    <build_type>ament_cmake</build_type>\r\n  </export>\r\n</package>\n'})}),"\n",(0,t.jsx)(s.h4,{id:"cmakeliststxt",children:(0,t.jsx)(s.code,{children:"CMakeLists.txt"})}),"\n",(0,t.jsxs)(s.p,{children:["This file instructs ",(0,t.jsx)(s.code,{children:"colcon"})," how to build the message interface."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-cmake",children:'# examples/ros2_custom_message_example/robot_status_msgs/CMakeLists.txt\r\ncmake_minimum_required(VERSION 3.8)\r\nproject(robot_status_msgs)\r\n\r\nif(CMAKE_COMPILER_ID STREQUAL "GNU")\r\n  add_compile_options(-Wall -Wextra -Wpedantic)\r\nendif()\r\n\r\nfind_package(ament_cmake REQUIRED)\r\nfind_package(rosidl_default_generators REQUIRED)\r\nfind_package(std_msgs REQUIRED)\r\n\r\nrosidl_generate_interfaces(${PROJECT_NAME}\r\n  "msg/RobotStatus.msg"\r\n  DEPENDENCIES std_msgs\r\n)\r\n\r\nament_export_dependencies(rosidl_default_runtime std_msgs)\r\n\r\nament_package()\n'})}),"\n",(0,t.jsx)(s.h3,{id:"3-build-the-custom-message-package",children:"3. Build the Custom Message Package"}),"\n",(0,t.jsxs)(s.p,{children:["Navigate to the root of your workspace (assuming ",(0,t.jsx)(s.code,{children:"examples/ros2_custom_message_example/"})," is within your ROS 2 workspace ",(0,t.jsx)(s.code,{children:"src"})," directory or directly in the workspace root) and build:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# From your ROS 2 workspace root, assuming examples/ros2_custom_message_example/ is in src/\r\ncolcon build --packages-select robot_status_msgs\n"})}),"\n",(0,t.jsx)(s.p,{children:"Then, source your workspace to make the message available:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n",(0,t.jsx)(s.h3,{id:"4-create-python-publisher-and-subscriber",children:"4. Create Python Publisher and Subscriber"}),"\n",(0,t.jsx)(s.p,{children:"Now that the message is built, we can use it in Python nodes."}),"\n",(0,t.jsxs)(s.h4,{id:"publisher-node-custom_status_publisherpy",children:["Publisher Node (",(0,t.jsx)(s.code,{children:"custom_status_publisher.py"}),")"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"# examples/ros2_custom_message_example/custom_status_publisher.py\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.time import Time\r\nfrom robot_status_msgs.msg import RobotStatus\r\nfrom std_msgs.msg import Header\r\n\r\nclass CustomStatusPublisher(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('custom_status_publisher')\r\n        self.publisher_ = self.create_publisher(RobotStatus, 'robot_status', 10)\r\n        timer_period = 1.0  # seconds\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n        self.status_code = 0\r\n\r\n    def timer_callback(self):\r\n        msg = RobotStatus()\r\n        msg.header = Header()\r\n        msg.header.stamp = self.get_clock().now().to_msg()\r\n        msg.status_code = self.status_code % 3  # Cycle through 0, 1, 2\r\n        msg.battery_level = 100.0 - (self.status_code * 5.0) # Example battery level decrease\r\n        if msg.status_code == 0:\r\n            msg.message = \"Robot operating normally.\"\r\n        elif msg.status_code == 1:\r\n            msg.message = \"Low battery warning.\"\r\n        else:\r\n            msg.message = \"System error detected.\"\r\n        \r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f'Publishing: \"{msg.message}\" (Battery: {msg.battery_level:.1f}%)')\r\n        self.status_code += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    custom_status_publisher = CustomStatusPublisher()\r\n    rclpy.spin(custom_status_publisher)\r\n    custom_status_publisher.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsxs)(s.h4,{id:"subscriber-node-custom_status_subscriberpy",children:["Subscriber Node (",(0,t.jsx)(s.code,{children:"custom_status_subscriber.py"}),")"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"# examples/ros2_custom_message_example/custom_status_subscriber.py\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom robot_status_msgs.msg import RobotStatus\r\n\r\nclass CustomStatusSubscriber(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('custom_status_subscriber')\r\n        self.subscription = self.create_subscription(\r\n            RobotStatus,\r\n            'robot_status',\r\n            self.listener_callback,\r\n            10)\r\n        self.subscription  # prevent unused variable warning\r\n\r\n    def listener_callback(self, msg):\r\n        self.get_logger().info(f'Received RobotStatus: Timestamp={msg.header.stamp.sec}.{msg.header.stamp.nanosec}, '\r\n                               f'Status Code={msg.status_code}, Battery={msg.battery_level:.1f}%, Message=\"{msg.message}\"')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    custom_status_subscriber = CustomStatusSubscriber()\r\n    rclpy.spin(custom_status_subscriber)\r\n    custom_status_subscriber.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(s.h3,{id:"5-how-to-run",children:"5. How to Run"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Place the ",(0,t.jsx)(s.code,{children:"robot_status_msgs"})," package and the two Python scripts (",(0,t.jsx)(s.code,{children:"custom_status_publisher.py"}),", ",(0,t.jsx)(s.code,{children:"custom_status_subscriber.py"}),") into the ",(0,t.jsx)(s.code,{children:"src/"})," directory of a new or existing ROS 2 workspace."]}),"\n",(0,t.jsxs)(s.li,{children:["From the root of your ROS 2 workspace, build the custom message package:","\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"colcon build --packages-select robot_status_msgs\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["Source your workspace:","\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"Open two separate terminal windows, source your workspace in each."}),"\n",(0,t.jsxs)(s.li,{children:["Run the publisher:","\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"python3 examples/ros2_custom_message_example/custom_status_publisher.py\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["In the other terminal, run the subscriber:","\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"python3 examples/ros2_custom_message_example/custom_status_subscriber.py\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["You should see the subscriber receiving the custom ",(0,t.jsx)(s.code,{children:"RobotStatus"})," messages."]})]})}function u(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>i});var n=r(6540);const t={},a=n.createContext(t);function o(e){const s=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);
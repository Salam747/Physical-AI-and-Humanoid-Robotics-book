# Data Model: Free RAG Chatbot Backend

**Feature Branch**: `006-rag-backend`  
**Created**: 2025-12-09  
**Plan**: ../plan.md
**Specification**: ../spec.md

## Overview

This document describes the key data entities and their attributes for the Free RAG Chatbot Backend, primarily focusing on how book content is structured and stored to support the Retrieval-Augmented Generation (RAG) process.

## Entities

### BookChunk

Represents a segmented portion of the "Physical AI Book's" text content. Each `BookChunk` is designed to be a discrete unit for embedding, storage in the vector database, and retrieval.

-   **Purpose**: Stores a manageable segment of the book's text and its corresponding vector embedding, along with metadata for traceability and contextualization.
-   **Storage**: Primarily stored in Qdrant (vector database) for vector search, with associated metadata mirrored or referenced in Neon Serverless Postgres (relational database).

#### Attributes:

| Attribute Name    | Type             | Description                                                                                             | Constraints/Notes                                                                   |
| :---------------- | :--------------- | :------------------------------------------------------------------------------------------------------ | :---------------------------------------------------------------------------------- |
| `id`              | UUID (string)    | Unique identifier for each `BookChunk`.                                                                 | Primary Key.                                                                        |
| `text_content`    | TEXT (string)    | The actual text segment extracted from the book.                                                        | Length between 300-600 tokens as per spec.                                          |
| `embedding`       | VECTOR (array)   | The vector representation of `text_content`, generated by Gemini `text-embedding-004`.                  | Stored in Qdrant for similarity search.                                             |
| `metadata`        | JSONB (JSON)     | A JSON object containing additional information about the chunk.                                        | Stored in Neon Postgres, possibly duplicated in Qdrant payload for efficiency.      |
| `metadata.source_file` | TEXT (string)    | The original Markdown file path (e.g., `module1-ros2.mdx`) from which the chunk was extracted.      | Used for traceability and to link back to the original document.                    |
| `metadata.page_number` | INTEGER (int)    | The estimated page number within the original document (if applicable/derivable).                     | Can be `null` if not applicable.                                                    |
| `metadata.chunk_index` | INTEGER (int)    | The sequential index of the chunk within its `source_file`.                                             | Used for ordering chunks from the same source file.                                 |

#### Relationships:

-   None directly modeled in a relational sense, as chunks are independent for vector search. However, `metadata.source_file` provides a logical link to the original book sections.

### Question

Represents the natural language query submitted by the user.

-   **Purpose**: The input to the RAG pipeline for retrieval and generation.
-   **Storage**: Not persisted in the primary backend data model, but logged for debugging/analytics (out of scope for this document).

#### Attributes:

| Attribute Name | Type          | Description                                         | Constraints/Notes |
| :------------- | :------------ | :-------------------------------------------------- | :---------------- |
| `question`     | TEXT (string) | The user's query about the book.                    | Required.         |
| `selected_text`| TEXT (string) | Optional specific text provided by the user for context. | Optional.         |

### Answer

Represents the generated natural language response from the RAG pipeline.

-   **Purpose**: The output from the chatbot, provided to the user.
-   **Storage**: Not persisted in the primary backend data model, but returned via API.

#### Attributes:

| Attribute Name | Type          | Description                                                                      | Constraints/Notes |
| :------------- | :------------ | :------------------------------------------------------------------------------- | :---------------- |
| `answer`       | TEXT (string) | The AI-generated response based on retrieved `BookChunk`s and `Question`.      | Required.         |
| `source_chunks`| ARRAY of `BookChunk` (simplified) | References to the `BookChunk`s used to generate the answer. | Optional, for transparency/debugging. |

## Relationships Between Entities

-   A `Question` leads to the retrieval of several `BookChunk`s.
-   `BookChunk`s and the `Question` are used to generate an `Answer`.
